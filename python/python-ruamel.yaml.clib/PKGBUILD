# POWER Maintainer: Alexander Baldeck <alex.bldck@gmail.com>
# Maintainer: George Rawlinson <grawlinson@archlinux.org>
# Contributor: Felix Yan <felixonmars@archlinux.org>
# Contributor: Bruno Pagani <archange@archlinux.org>
# Contributor: Samuel Littley <aur@toastwaffle.com>
# Contributor: rnons <remotenonsense at gmail dot com>

_pkg=ruamel.yaml.clib
pkgname=python-$_pkg
pkgver=0.2.15
pkgrel=2
pkgdesc='C version of reader, parser and emitter for ruamel.yaml derived from libyaml'
arch=(x86_64 powerpc64le powerpc64 powerpc espresso)
url='https://sourceforge.net/projects/ruamel-yaml-clib/'
license=(MIT)
depends=(python)
makedepends=(python-build python-installer python-setuptools python-wheel)
source=("$pkgname-$pkgver.tar.gz::https://yaml.dev/ruamel-dl-tagged-releases/ruamel.yaml.clib-$pkgver.tar.xz")
sha512sums=('d008eb4001dae9e3bdfdab5f2db55fbe2eb03f8b9ae23c28caec9c3759bf079a84545a3124596914eaa83993d2d9d211a21125f20ffb72be90b0d29a978f5f4c')
b2sums=('e0d88a7f4ad98d66466669b57fbd365c44c094355ff89b0ee9af936e5db92088e757ff9a19bbb2391d4c7b126bd62da87f0b6a8ea01f4a54d4d761c2c2822369')

build() {
  cd "${_pkg}-${pkgver}"

  # Workaround for GCC 14, see https://sourceforge.net/p/ruamel-yaml-clib/tickets/22/
  CFLAGS="$CFLAGS -Wno-error=incompatible-pointer-types" \
  python -m build --wheel --skip-dependency-check --no-isolation
}

package() {
  cd ${_pkg}-${pkgver}

  python -m installer --destdir="${pkgdir}" dist/*.whl

  # license
  install -vDm644 -t "$pkgdir/usr/share/licenses/$pkgname" LICENSE
}
