From 11dfb4a90bb6e67e32dbdbd85f6c3ce4f1e18b96 Mon Sep 17 00:00:00 2001
From: Carl Smedstad <carsme@archlinux.org>
Date: Sat, 27 Dec 2025 21:14:26 +0100
Subject: [PATCH] Fix compatibility with external schemas from schemastore

- Handle schemas without 'properties' key in remote.py to avoid KeyError
- Add uint64 format validator for schemas using this format
---
 src/validate_pyproject/formats.py | 5 +++++
 src/validate_pyproject/remote.py  | 2 +-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/src/validate_pyproject/formats.py b/src/validate_pyproject/formats.py
index 1cf4a46..d6e6de3 100644
--- a/src/validate_pyproject/formats.py
+++ b/src/validate_pyproject/formats.py
@@ -373,6 +373,11 @@ def uint(value: builtins.int) -> bool:
     return 0 <= value < 2**64
 
 
+def uint64(value: builtins.int) -> bool:
+    r"""Unsigned 64-bit integer (:math:`0 \leq x < 2^{64}`)"""
+    return 0 <= value < 2**64
+
+
 def int(value: builtins.int) -> bool:
     r"""Signed 64-bit integer (:math:`-2^{63} \leq x < 2^{63}`)"""
     return -(2**63) <= value < 2**63
diff --git a/src/validate_pyproject/remote.py b/src/validate_pyproject/remote.py
index 1ccae6e..3a81510 100644
--- a/src/validate_pyproject/remote.py
+++ b/src/validate_pyproject/remote.py
@@ -78,7 +78,7 @@ def load_store(pyproject_url: str) -> Generator[RemotePlugin, None, None]:
             _logger.info(f"Loading {tool} from store: {pyproject_url}")
             rp = RemotePlugin.from_url(tool, info["$ref"])
             yield rp
-            for values in rp.schema["properties"].values():
+            for values in rp.schema.get("properties", {}).values():
                 url = values.get("$ref", "")
                 if url.startswith(("https://", "https://")):
                     yield RemotePlugin.from_url("", url)
-- 
2.52.0

