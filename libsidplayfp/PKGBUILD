# POWER Maintainer: Alexander Baldeck <alex.bldck@gmail.com>
# Maintainer: George Rawlinson <grawlinson@archlinux.org>
# Contributor: Alexander F. Rødseth <xyproto@archlinux.org>
# Contributor: Gaetan Bisson <bisson@archlinux.org>
# Contributor: Simon Perry <aur [at] sanxion [dot] net>
# Contributor: Jonas Nyrén <jonas.nyren*mindkiller.com>

pkgname=libsidplayfp
pkgver=2.15.2
pkgrel=1
pkgdesc='Library to play Commodore 64 music'
arch=(x86_64 powerpc64le powerpc64 powerpc espresso)
url='https://github.com/libsidplayfp/libsidplayfp'
license=(GPL-2.0-only)
depends=(glibc gcc-libs libgcrypt)
makedepends=(git vice xa)
optdepends=('vice: better SID support')
source=(
  "$pkgname::git+$url#tag=v$pkgver"
  'github.com-libsidplayfp-exsid-driver::git+https://github.com/libsidplayfp/exsid-driver'
  'github.com-libsidplayfp-resid::git+https://github.com/libsidplayfp/resid'
)
sha512sums=('2b218aff35e13f684d3cb7437d17e6203c8a337aa4c99c8eca6697bcd7752e7b74288ca1e86dacef34431b36b5396f5b33d58d7d95b334a68c3521058f8f5805'
            'SKIP'
            'SKIP')
b2sums=('6fbb7d973b5898bd1238c61dc2bc98e8e3d9a3839fdb8788c04f7e20af5667141efdc5ab8bbe5de37e499302fbfb0f7c96b884163a67e1952cfafeb54e48853d'
        'SKIP'
        'SKIP')

prepare() {
  cd "$pkgname"

  # prepare git submodule(s)
  git submodule init
  git config submodule.src/builders/exsid-builder/driver.url "$srcdir/github.com-libsidplayfp-exsid-driver"
  git config submodule.src/builders/resid-builder/resid.url "$srcdir/github.com-libsidplayfp-resid"
  git -c protocol.file.allow=always submodule update
}

build() {
  cd "$pkgname"

  autoreconf -vfi

  ./configure --prefix=/usr

  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool

  make
}

package() {
  DESTDIR="$pkgdir" make -C "$pkgname" install
}
