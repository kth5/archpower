# POWER Maintainer: Alexander Baldeck <alex.bldck@gmail.com>
# Contributor: Daniel Isenmann <daniel@archlinux.org>
# Contributor: William Rea <sillywilly@gmail.com>

pkgname=libgpod
pkgver=0.8.3
pkgrel=20
pkgdesc='A shared library to access the contents of an iPod'
arch=(x86_64 powerpc64le powerpc64 powerpc espresso)
url='https://sourceforge.net/projects/gtkpod/'
license=(LGPL-2.1-or-later)
depends=(
  gdk-pixbuf2
  libimobiledevice
  libplist
  sg3_utils
  sqlite
  usbmuxd
  libusb
  glibc
  zlib
  glib2
  libxml2
)
makedepends=(
  docbook-xsl
  gtk-doc
  intltool
)
provides=(libgpod.so)
options=(!emptydirs)
source=(
  https://downloads.sourceforge.net/sourceforge/gtkpod/${pkgname}-${pkgver}.tar.bz2
  libgpod-0.8.2-pkgconfig_overlinking.patch
  libgpod-0.8.3-pkgconfig_sharp.patch
  libgpod-playcounts.patch
  libgpod-udev.patch
  libgpod-0.8.3-libplist-2.2.patch
  libgpod-0.8.3-libplist-2.3.patch
  libgpod-0.8.3-implicit-int.patch
  libgpod-0.8.3-pointer-types.patch
)
sha512sums=('e39f22054c2d2bdf5fc764aa1f692de17a1a06c7c7e9c60883d126b216dacca7840bf818e7e7e039218fe2a64c0920ba96d8cbbe310e11c1c4e68b82e7cbbd8e'
            'c8ebcc18ba7b44aef8fada3f9fea88fdaaf6bae12cf809b08f98e85ab6396ae032bfd7706809cd266be67c694749d4364a9cc591eb750478e095cbbcbe061419'
            '3266c9cd02d06265b9ec8a967058042a4b6bfabfda8db1b6de59d8b87db5ab63e8a256d5e0f22c2f2dec8e8d229b62283f117b49eae07e71ee2455a34d645d92'
            'ee72d5875e2240b46c943ae3e45949d08b4fe4916d28b266a70afc52ab40e5d41fbba723376b74e84cd4828562e5fea703eca73e70de34980061ed20c82fe61c'
            '74f015329656d196674d4d4c9dab247e0e1d0fe969237811af87751927684b42f050d6ec03002154b04c78a5917cb99ee90dd1f3de226e0c9cb73ebac8944713'
            'd09d6f17930d3b52eb3a5d18978f70a62be79f7499adac1f04212668f062464b6d1ad5ad12d99eab418731dd91db009b0e0ff12386a027267513c9303ffb0392'
            '905c8e0d3ecec00ff0879a7780e372e449d132b2961dec7adf9e5106b55facecd706460f82c0ac1e8ea41d14c68a8691e1e379aa504c4e87f2cc889cf90e6cdc'
            '1445c67d6b315efefd69071c4a45c58f341c2bfadb4e154e693e30987c26861e5d2776f9c7a400f4589e1a899cf2d5e438a7475f22dcd20f1101e2ccacba88c4'
            '10eb4fd50452c1c5e5517e2fe2bc3bc774253c540c1b281cb7b4222bef84a354779318d1d503b590c06160fd58f18cf940e9a8a347900db29e146f55595a9c6b')
b2sums=('e9bc54d23be7f54a17eea3f8a07d7bf6a28224d9c0b0f90fb9d44d97af6cf64c31096de5d9fa4b446e1a9463a6e8f3a59929d73bf52ad8d638732868c3c1b7d0'
        '74d924d61ce33c4fd0219e8dedb505bd66cd40e9912efb2dbbb5df31c2bea943ea4a4eb8b9e9baf2762966b02efae3f77c73293f8a4a581f6a43be4cc22eb727'
        '453bbd8e3df739a4eb3049776911996f9fdf56404841a2f41834c9a068486111192bb188773c4e674417d0e6fdb47fe1527bfac087bfd5594bfba78e77ff8f45'
        '8a46f6ff8dab53e6fa608e7f8896bd8394ea15868b4c949895d3bd6fca1d8d08b2c3a9d1b294804b850f30b5cb0149283b8ee2618b22dfc45526392f40264d29'
        '4771e49da6a229481d81db5a98a0f6d25f5e541f05a8be8da002214fd9ad3dc688693397c7e2d9855e8ade56709cd4f420817120c0556d00554771a760836500'
        '6226ae75d54eead5bb2eaa1af55c5170e02c4f30d3dc7bd5e8d81029d86627148d90d0a2be8ece4dd59300e66f27f3eea93522cd765cd14a335ebe3bb9809f8e'
        'a1c3f633966d4181197b22cd94a253bce94c8e76bdd4fdd0015a6ef012bc9a70c96b77a322913ba00e0ef586ec3b292b811684c3e6626648f7641bb86fa8ba5a'
        'c12dfc683301089f73c6dc33acf38b012cdaba16dcae033db5bd027d7d48b0e2a93df0a27a690944d904fb2c6d9bef0c97fd62aea16e3a70e7404d2a1926efdd'
        '0d86c14195e55459f681c79f0bf660d00d55213d732d999f0cc75dedad2c3fd109014f4480e89f74ab190bbea6a3dce30309c04cd493893a97e53b689a3af5c9')

prepare() {
  cd $pkgname-$pkgver

  patch -p1 -i "$srcdir/libgpod-0.8.2-pkgconfig_overlinking.patch"
  patch -p1 -i "$srcdir/libgpod-0.8.3-pkgconfig_sharp.patch"
  patch -p1 -i "$srcdir/libgpod-playcounts.patch"
  patch -p1 -i "$srcdir/libgpod-udev.patch"
  patch -p1 -i "$srcdir/libgpod-0.8.3-libplist-2.2.patch"
  patch -p1 -i "$srcdir/libgpod-0.8.3-libplist-2.3.patch"
  patch -p1 -i "$srcdir/libgpod-0.8.3-implicit-int.patch"
  patch -p1 -i "$srcdir/libgpod-0.8.3-pointer-types.patch"

  autoreconf -fvi
}

build() {
  local configure_options=(
    --prefix=/usr
    --enable-udev
    --with-mono=no
    --with-python=no
    --with-udev-dir=/usr/lib/udev
  )

  cd $pkgname-$pkgver
  CFLAGS+=" -Wno-incompatible-pointer-types -Wno-implicit-int" \
  ./configure "${configure_options[@]}"
  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
  make
}

package() {
  cd $pkgname-$pkgver
  make DESTDIR="${pkgdir}" install
}

# vim:set sw=2 sts=-1 et:
