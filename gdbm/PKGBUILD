# POWER Maintainer: Alexander Baldeck <alex.bldck@gmail.com>
# Maintainer: David Runge <dvzrv@archlinux.org>
# Contributor: Bartłomiej Piotrowski <bpiotrowski@archlinux.org>
# Contributor: Stéphane Gaudreault <stephane@archlinux.org>
# Contributor: Allan McRae <allan@archlinux.org>
# Contributor: judd <jvinet@zeroflux.org>

pkgname=gdbm
pkgver=1.26
# latest, versioned translation from https://translationproject.org/domain/gdbm.html
_translation_version=1.26
pkgrel=1
pkgdesc="GNU database library"
arch=(x86_64 powerpc64le powerpc64 powerpc espresso)
url="https://www.gnu.org/software/gdbm/gdbm.html"
license=(GPL-3.0-or-later)
depends=(
  glibc
  sh
)
makedepends=(
  git
  readline
)
provides=(
  libgdbm_compat.so
  libgdbm.so
)
source=(
  git+https://git.gnu.org.ua/gdbm.git?signed#tag=v$pkgver
  https://translationproject.org/PO-files/da/$pkgname-$_translation_version.da.po
  https://translationproject.org/PO-files/de/$pkgname-$_translation_version.de.po
  https://translationproject.org/PO-files/eo/$pkgname-$_translation_version.eo.po
  https://translationproject.org/PO-files/es/$pkgname-$_translation_version.es.po
  https://translationproject.org/PO-files/fi/$pkgname-$_translation_version.fi.po
  https://translationproject.org/PO-files/fr/$pkgname-$_translation_version.fr.po
  https://translationproject.org/PO-files/ja/$pkgname-$_translation_version.ja.po
  https://translationproject.org/PO-files/ka/$pkgname-$_translation_version.ka.po
  https://translationproject.org/PO-files/pl/$pkgname-$_translation_version.pl.po
  https://translationproject.org/PO-files/pt_BR/$pkgname-$_translation_version.pt_BR.po
  https://translationproject.org/PO-files/ro/$pkgname-$_translation_version.ro.po
  https://translationproject.org/PO-files/ru/$pkgname-$_translation_version.ru.po
  https://translationproject.org/PO-files/sr/$pkgname-$_translation_version.sr.po
  https://translationproject.org/PO-files/sv/$pkgname-$_translation_version.sv.po
  https://translationproject.org/PO-files/uk/$pkgname-$_translation_version.uk.po
  https://translationproject.org/PO-files/vi/$pkgname-$_translation_version.vi.po
)
sha512sums=('7a964fae6f8383196e6b40bccad952723ba8c601c7d50153b4011db5bbb908202a6caf61055a3cceaab8dd71c4232420373a9d864a85fd8708097f4e1ce88c8a'
            'c4769afe6c72e5ac4047b2b2da1688bed7a8fa0d18b12e44d8eec906baf8f35ccf4d0d451da13815f67e1c3994561dd714a45585181eff4b40e44b407a33001c'
            'd909853c81ecfa0cbcb9777a93550ae95d3566f8cdb95fab9e886f7acaa96ae2c631e825c7c49a42ed3d3af6e376a61c2079d6ece432644a5d1680d8932baf9b'
            'dee1aa87071ca7d66ceee547b1b5d1d3c0de3f08a82e0a6b3c9aa733f404f7b2e52d7f1b151d6306f43f8fe5061965598d0b1034421e9efb2ba2b8f2a18bfec0'
            '5860a4193bd34ffeb06277debb540dbfa8147cb0b1398c26b665c2e38f1d995eb66ede1d618f76135bd8617543889c67b46c3aa622b454c5da86429565288194'
            '841c34a6a3b238525b699fd326140c5744346f4467ada18f829ee675dd9d737c1adae4c675def2f9b306d3d846e86a2f4be91010c5b846ffa128b004e1a037c6'
            '7aa7148818da74527a1db43df6be38ec207ef7003e316a98fef4493e7129ae18a4c515b62ef9e6cd5657cca6d7bd93d6fd01d3e11d71d9b862056f0e6383dfa9'
            'b59550186e6dbedf089716c614aa80c5fde602949b6e197ea95123e78ae2643623ef996d661c0df61fd9acf8828a89d3828e40fc11f7c338af3db49746120fcf'
            '59b7824771e20cf9d201ae1579201df9e34d8a4db022f8bb1c5a2d608bef7e20826c04ccea2577b57e737404f2a12e1da3b7bb69d7064d1228902e91bd1fc7a8'
            '45ea221adb8d0560575a6f12b2d6bcd3a6a1843dd5aac9a93c124cb87383284f63d9948a89808fd49a1131e157e98d9eb29d992b1f90ba55443ff0a276d4bcca'
            'ac1a26682a8d7184b03de03a856ce92ad988bcbbba2f3b55823feb6576cfc19dc9e18c3147e05042f8c4f3029125e19615d69e084326423252d3cc7efe081346'
            '0795ec342151fa9e1bc60c1f02dcdb59a963e610b3026995354b37c9152d42dea1804d2054d235cb5bd6bcad3b48e3ef169da1889743c0de0d5cee8326c62d2a'
            '0b1429200976535aa8e770230c7b2b250a5b1440f28d206c742aafbd15b16131e4f4cb5761b6050b5cf59a306f47ac51a2dfb821bcc20cf71ef06e835418db79'
            'ab0d9336e5e70eeea876c41f5428e7ee88829ba2fde5ba37c29551288b97ea59bafa88507fc40ead40ec7981fdf772881292001e55eb39117a6b5ff2262cbb43'
            '25a7b59c5f0b54928501a1efd3566e696e853382d7f41bb5247fb8d777cece9db81e8db1e1e751f15eb71df9f0972a21d5715f9ccbb6f37f3c575e7e4e8e0b2e'
            'd6f813ba690dd681aabbcf8552161a112e4586d05665e9749cce569bcdc792714d40861f47704b755d778c115b54f0a819d6628a452e195e5cafa67e666f7f91'
            '4b38a5f3d6bdee9cb0ad8e464de4c6901d280a546053ec652ca01ee34b9c9f1fd8cfc1760c8396515de3674b85379a65ee6d298afc4b2019c83232d74e1abb9e')
b2sums=('fe795dd537d5904ab6762c85e6dd750278dd039e1fc189563c1111e2ccbaa3a43f326f8ac01392480a332ad06f420e19b3a7fe991354380e34e34807a2d3c176'
        '951bce4dd408048caac651d9f16d9a8f921153c09029b8f95dfc04091586ed096372b29ace60fcf41b319903e68d3412efa8cf54c8e90a0bce1f1028c9b3de06'
        'e88387b3aa45ac35e55d598297e43077be36c15ced4cad4f307721abf1349bca5064af31a607d28a65878f96c59af6613374bacdcba523f85cc3c86ddb8dd7a7'
        '6d3bd7d030474be9e6805edb9ac73ae53ab35f27094ed98a586044af0939306cf7002139f2de3b1b12a2455682626fe6f25971617836dd0889d3abc7a32c3f81'
        'f485216121f0d866e9d682adb8ac6a97c3501e9fa4554a04aef50a2212ef69e86692f3cfdfef5337a9936f007a86f59d265ebdcb43de185ae8d9f0922e7b644a'
        '2eec2bbfab8678dc2aa420335559789cf099cc79f4ee083e9e2f76d26cd170458301d11b20da41aded9e59fb93aac1f7e3c29a2ad60fd5de1354a5ac344f13a1'
        '9c9cb520534f59d6f9f7f87525f7bd3058c6bd174e738891d8379fd974f4124551ec21cb8b75938eced1e543b7843cccf25e3dceb7bc8e8dbd2ed379a13c4270'
        '680993077d051fb6a1874cb67b5555fdb124054044e45cdca0784423036c6c0b9c4261c765ec4c0963394aaf3a83230ee0ac5836b4edaebe9327e22493c87984'
        '0659cd81a77850541ad13dde7a22c7530c59e4cc1d483f7a5f162e0a059204b83012d2ec8de58484f0395a9fe574fc8a10a3815d9680ef73d63ffc4976ebc5e7'
        'bd3db1854184ed19b6ebe58746f77747eac54800d1e78e208951108085a356cda5ea11e872f8ef920a01fc3f3b5576281f07bf265e627d2312c7cbc891756f8d'
        '83067c97d1509c1651ff312c6027dad951df1ef514b1c7ec2e66e35a4bb79e1f0f0d1ac049f12ad37215294d40d461bceda0e83cb82fb42aea543eeeca52e249'
        'b61483738012105d8dbd1bcc0485ee72a03b8047e05766b6883af23a1406ac7fbc29baf2ab9f5608dcac606597207db24e0d5a48648221b9fcec4d8a985d7d9c'
        'b522a50f84e19e0f78932a802f3c023e538bcdb2691b874acdaef2aecd2f99e4b2f10e86bb2784c8a0c5147284a7dfaa095b13ea8639237ca6c7fba693b1d824'
        'ebb6bc12aac75813d9d32b7b164931c66d980dcae816eb6f26bffc536ee71983fb7ffa6f4276f076d9c0486e751e41393e095e5d6d73dec42d769c050ddcd7f5'
        '6a10bed2142f943d9fb28e2b56b804f798cf0bb8357bbcee51ce396e3514cfb1c4821f34510469d0e57f620a7b6aa2e0b20e89a2b6b73525d0c4827c376d70db'
        'bbaca53bcdbd3595d2f637cdd75e7aaae2b7166c32e899b4ec623bb8668abbd70679936c58f53017582d399a308855e964ea863ca288bfb34c7b7e036e7a7838'
        '6f7a4146b2c115dc88f78336ac1b0ff711d09d0fa490931c25a6fb0443baec8a3c8cf75c086feaae7b25fb3b65e3fc068c919e8b63bdc258904670c31b5942b8')
validpgpkeys=(
  4BE4E62655488EB92ABB468F79FFD94BFCE230B1  # Sergey Poznyakoff <gray@gnu.org>
)

prepare() {
  local po_file new_po

  # prepare translations
  touch $pkgname/po/LINGUAS
  for po_file in *.po; do
    new_po="${po_file/$pkgname-$_translation_version./}"
    cp -v $po_file $pkgname/po/$new_po
    printf "%s\n" ${new_po/.po/} >> $pkgname/po/LINGUAS
  done

  cd $pkgname
  autoreconf -fiv
}

build() {
  local configure_options=(
    --prefix=/usr
    --enable-libgdbm-compat
  )

  cd $pkgname
  ./configure "${configure_options[@]}"
  make
}

check() {
  make check -C $pkgname
}

package() {
  depends+=(
    readline libreadline.so
  )

  make DESTDIR="$pkgdir" install -C $pkgname
  install -vDm 644 $pkgname/{NOTE-WARNING,AUTHORS,NEWS,README} -t "$pkgdir/usr/share/doc/$pkgname"
}
